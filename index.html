<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sessioni di Gioco – Archivio</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f4f4f4;
        }
        h2 {
            margin-bottom: 10px;
        }
        .session {
            background: white;
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 6px;
            box-shadow: 0 0 4px rgba(0,0,0,0.2);
        }
        .session strong {
            font-size: 1.2em;
        }
    </style>
</head>

<body>

<h2>Archivio Sessioni</h2>
<div id="archivioContainer">Caricamento...</div>

<script>
/* ================================
   CONFIGURAZIONE JSONBIN
================================ */

const JSON_BIN_API_KEY = "$2a$10$jyfQtGxraAzGJat.A7ksZ.Z4RQ2Tjzx3YvAwd7Ro.seCzFmfE3PyC"; 
const BIN_ID = "6734a8c6acd3cb34a8af78d8";  // il tuo bin ID rimane lo stesso

/* =======================================
   FUNZIONE PER LEGGERE I DATI SU JSONBIN
======================================= */
async function fetchBin(binId) {
    try {
        const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
            headers: { "X-Access-Key": JSON_BIN_API_KEY }
        });

        if (!response.ok) {
            throw new Error(`Errore HTTP durante fetch: ${response.status}`);
        }

        const data = await response.json();
        return data.record ?? [];
    } catch (error) {
        console.error("Errore fetchBin:", error);
        return [];
    }
}

/* =======================================
   FUNZIONE PER SCRIVERE SU JSONBIN
======================================= */
async function updateBin(binId, data) {
    const payload = { record: data };

    try {
        const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                "X-Access-Key": JSON_BIN_API_KEY
            },
            body: JSON.stringify(payload)
        });

        return response.ok;
    } catch (error) {
        console.error("Errore updateBin:", error);
        return false;
    }
}

/* =======================================
   VISUALIZZAZIONE ARCHIVIO
======================================= */

async function mostraArchivio() {
    const archivioContainer = document.getElementById("archivioContainer");
    archivioContainer.innerHTML = "Caricamento archivio...";

    const sessioni = await fetchBin(BIN_ID);

    if (!sessioni || sessioni.length === 0) {
        archivioContainer.innerHTML = "<p>Nessuna sessione salvata.</p>";
        return;
    }

    archivioContainer.innerHTML = "";

    sessioni.forEach((s, index) => {
        const div = document.createElement("div");
        div.className = "session";

        div.innerHTML = `
            <strong>Sessione ${index + 1}</strong><br>
            <b>Data:</b> ${s.data}<br>
            <b>Saldo Iniziale:</b> €${s.saldoIniziale}<br>
            <b>Saldo Finale:</b> €${s.saldoFinale}<br>
            <b>Esito:</b> ${s.esito}<br>
            <b>Dettagli:</b> ${s.dettagli}
        `;

        archivioContainer.appendChild(div);
    });
}

// avvia caricamento archivio
mostraArchivio();

</script>

</body>
</html>
